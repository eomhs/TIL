# 네트워크 심화
## 안정성을 위한 기술
### 안정성을 수치로 표현하는 가용성
- 가용성(availability)
    - 컴퓨터 시스템이 특정 기능을 실제로 수행할 수 있는 시간의 비율
    - 전체 사용 시간 중에서 정상적인 사용 시간
        - 업타임(uptime): 정상적인 사용 시간
        - 다운타임(downtime): 정상적인 사용이 불가능한 시간
    - 고가용성(HA)
- 일반적으로 '안정적'인 시스템은 가용성 99.999%(파이브 나인스) 이상을 목표
### 그렇다면 안정성은 어떻게 높일 수 있을까?
- 다운타임을 낮추면 됨
    - 서비스는 왜 다운될까?
        - 과도한 트래픽
        - 예기치 못한 소프트웨어상의 오류
        - 하드웨어 문제
    - 결함 감내(fault tolerance)
        - 문제가 발생하더라도 기능할 수 있는 능력
### 이중화
- 결함을 감내하여 가용성을 높이기 위한 가장 기본적이고 대표적인 방법
    - '백업을 마련하는 방법'
    - 무엇을 이중화해야 할까?
    - '문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상': SPoF (Single Point of Failure)
        - 서버 컴퓨터, 네트워크 인터페이스, 스위치 등 물리적 장비
        - 데이터베이스, 웹 서버 프로그램 등
- 구성 방법
    - 액티브/스탠바이(active-standby)
        - 한 시스템은 가동하고, 다른 시스템은 백업 용도로 대기 상태(스탠바이)
    - 액티브/액티브(active-active)
        - 두 시스템 모두를 가동 상태
- 이중화의 확장, 다중화
    - 무언가를 여러 개 두는 기술
- 이중화/다중화의 사례, 티밍(teaming)과 본딩(bonding)
    - 여러 네트워크 인터페이스(NIC)를 이중화/다중화하여 더 뛰어나고 안정적인 성능의 하나의 인터페이스처럼 보이게 하는 기술
### 로드 밸런싱
- 로드 밸런싱(load balancing), 트래픽의 고른 분배를 위한 기술
    - 로드 밸런서(load balancer)에 의해 수행
        - 전용 네트워크 장비(L4 스위치, L7 스위치)로 수행
            - L4 스위치는 IP 주소와 포트 번호와 같은 전송 계층까지의 정보를 바탕으로 로드 밸런싱
            - L7 스위치는 URI, HTTP 일부, 쿠키 등 응용 계층의 정보까지 활용하여 로드 밸런싱
        - 로드 밸런싱 소프트웨어를 설치하면 일반 호스트도 로드 밸런서로 사용 가능
            - HAProxy, Envoy 등
            - Nginx에도 로드 밸런싱 기능이 내포
- 로드 밸런서의 위치
    - 일반적으로 이중화/다중화된 서버와 클라이언트 사이에 위치
    - 클라이언트들은 로드 밸런서에 요청을 보내고, 로드 밸런서는 해당  요청을 각 서버에 균등하게 분배
- 서버의 상태를 검사하는 헬스 체크
    - 헬스 체크(health check)
        - 서버들의 건강 상태를 주기적으로 모니터링하고 체크
        - 주로 로드 밸런서에 의해 이루어짐
        - HTTP, ICMP 등 다양한 프로토콜을 활용
    - 서버 간 하트비트(heartbeat)라는 메시지를 주기적으로 주고받는 방법도 있음
- 로드 밸런싱 알고리즘
    - 라운드 로빈 알고리즘(round robin algorithm)
        - 단순히 서버를 돌아가며 부하를 전달
    - 최소 연결 알고리즘(least connection algorithm)
        - 연결이 적은 서버부터 우선적으로 부하를 전달
    - 기타
        - 무작위
        - 해시(hash) 자료구조를 이용하는 알고리즘
        - 응답 시간이 가장 짧은 서버를 선택하는 알고리즘
- 가중치가 부여된 알고리즘
    - 가중치 라운드 로빈 알고리즘(weighted round robin algorithm)
    - 가중치 최소 연결 알고리즘(weighted least connection algorithm)
    - 서버 간 성능이 다른 경우 주로 가중치가 적용된 알고리즘이 유리
