# 응용 계층
## DNS와 자원
### 메시지를 주고받기 위해
- 메시지를 주고받는 송수신지 파악
    - IP 주소, 도메인 네임
- 송수신하고자 하는 정보 파악
    - Resource
### 도메인 네임과 네임 서버
- IP 주소만으로 송수신지 특정하는 것은 번거로움
    - 통신하고자 하는 모든 호스트의 IP 주소를 기억하기 어려움
    - IP 주소는 언제든 바뀔 수도 있음
    - 그래서 상대 호스트 특정을 위해 도메인 네임 사용
    - 도메인 네임
        - 호스트의 IP 주소와 대응되는 문자열 형태의 호스트 특정 정보
    - 네임 서버(DNS 서버)에서 관리
        - IP 주소 변경되어도 도메인 네임 다시 대응하면 그만임
    - 네임 서버가 공용 전화번호부라면, 개인 전화번호부 같은 hosts 파일도 있음
        - 도메인 네임과 IP 주소의 대응 관계를 담은 파일
        - hosts 파일 위치: `/etc/hosts`
### 네임 서버의 관리
- 도메인 네임의 구조로 알아보는 네임 서버 관리 방법
- 점(.)을 기준으로 계층적으로 분류
    - 루트 도메인(root domain): 맨 끝에 사실 .이 있는데 생략된 것
    - 최상위 도메인(TLD)
    - 2단계 도메인, 3단계 도메인, 4단계 도메인...
- 전체 주소 도메인 네임(FQDN: Fully-Qualified Domain Name)
    - 전체 도메인 계층을 모두 포함하는 도메인 네임
    - FQDN까지 알면 비로소 하나의 호스트를 식별할 수 있게 됨
- 서브 도메인(subdomain)
    - 다른 도메인이 포함된 도메인
    - ex) google.com의 서브 도메인
        - www.google.com
        - mail.google.com
        - drive.google.com 등등
- 계층적 도메인 네임
    - 이를 관리하기 위한 네임 서버도 계층적으로 관리
    - 네임 서버는 전 세계 여러 군데 분산되어 위치
- 계층적이고 분산된 도메인 네임에 대한 관리 체계 = DNS
### 계층적 네임 서버
- 도메인 네임에 대응하는 IP 주소를 알아내는 과정
    - 도메인 네임을 풀이(resolve)한다
    - 계층적이고 분산된 네임 서버들이 사용됨
    - 주요 네임 서버의 유형: 로컬 네임 서버(리졸버), 루트 네임 서버, TLD 네임 서버, 책임 네임 서버
- 로컬 네임 서버(local name server)
    - 클라이언트와 맞닿아 있는 네임 서버
        - 클라이언트가 도메인 네임을 통해 IP 주소를 알아내고자 할 때 가장 먼저 찾게 되는 네임 서버
        - 로컬 네임 서버의 주손느 일반적으로 ISP에서 할당
        - 공개 DNS 서버(public DNS Server)를 이용할 수도 있음
- 루트 네임 서버(root name server)
    - 루트 도메인을 관장하는 네임 서버
        - 로컬 네임 서버가 대응되는 IP 주소를 모를 경우
        - TLD 네임 서버의 IP 주소를 반환할 수 있음
- TLD 네임 서버
    - TLD를 관리하는 네임 서버
    - DNS 질의에 대해 TLD의 하위 도메인 네임을 관리하는 네임 서버 주소 반환
        - 하위 도메인 네임을 관리하는 네임 서버는 그보다 하위 도메인 네임을 관리하는 네임 서버 주소를 반환
- 책임 네임 서버(authoritative name server)
    - 특정 도메인 영역(zone)을 관리하는 네임 서버
        - 다른 네임 서버에게 떠넘기지 않고 곧바로 답할 수 있는 네임 서버
        - 즉, 책임 네임 서버는 로컬 네임 서버가 마지막으로 질의하는 네임 서버
        - 일반적으로 로컬 네임 서버는 책임 네임 서버로부터 원하는 IP 주소를 알아냄
- 네임 서버의 계층적 구조를 토대로 IP 주소를 알아내는 과정
    - 재귀적 질의(recursive query)
    - 반복적 질의(iterative query)
- 재귀적 질의
    - 클라이언트 -> 로컬 네임 서버 -> 루트 네임 서버 -> TLD 네임 서버 -> 책임 네임 서버에게 질의
    - 최종 응답 결과를 역순으로 전달
- 반복적 질의
    - 네임 서버에 일일이 질의-응답 반복
    - 최종 응답 결과를 클라이언트에게 전달
### DNS 캐시
- 조금 문제가 있다
    - 앞선 예시는 8단계를 거치게 됨
    - 시간이 오래 걸리고 네트워크상의 메시지 수가 지나치게 늘어날 수 있음
    - 루트 네임 서버에 과부하 우려
- DNS 캐시(DNS cache)
    - 네임 서버들이 기존에 응답받은 결과를 임시로 저장했다가 추후 같은 질의에 이를 활용
    - DNS 캐시를 저장하는 용도로만 사용되는 서버도 있음
    - DNS 캐시를 활용하면 더 짧은 시간 안에 원하는 IP 주소를 얻어낼 수 있음
    - DNS 캐시는 영원히 남아있는 것은 아님(TTL)
 ### 자원을 식별하는 URI 
- 자원(resource): 네트워크상의 메시지를 통해 주고받는 대상
    - 두 호스트가 네트워크를 통해 서로 정보를 주고받을 때, 송수신하는 대상
        - HTML 파일
        - 이미지나 동영상 파일
        - 텍스트 파일 등
- 자원은 'HTTP 요청 메시지의 대상'이라 보기도
- 자원을 식별할 수 있는 정보, URI (Uniform Resource Identifier)
    - URL (Uniform Resource Locator)
        - 위치를 지용해 자원을 식별
        - 거의 이 방식
    - URN (Uniform Resource Name)
        - 이름을 이용해 자원을 식별
### URL
- 오늘날 인터넷 환경에서 자원 식별에 더 많이 사용되는 식별자
- URL의 구조 (RFC 3986)
    1. scheme
        - URL의 첫 부분인 scheme은 '자원에 접근하는 방법'을 의미
        - 일반적으로 사용할 프로토콜이 명시
            - ex) HTTP/HTTPS 등
    2. authority
        - authority에는 '호스트를 특정할 수 있는 정보', 이를테면 IP 주소 혹은 도메인 네임이 명시
        - 콜론(:) 뒤에 포트 번호를 덧붙일 수도 있음
    3. path
        - path에는 '자원이 위치한 경로'가 명시
        - 자원의 위치는 슬래시(/)를 기준으로 계층적으로 표현되고, 최상위 경로 또한 슬래시로 표현
    4. query
        - query string, query parameter
        - 물음표(?)로 시작되는 <key, value> 형태의 데이터
        - 앰퍼샌드(&)로 여러 쿼리 문자열을 덧붙일 수 있음
    5. fragment
        - fragment는 '자원의 한 조각을 가리키기 위한 정보'
            - HTML 파일과 같은 자원에서 특정 부분을 가리키기 위해 사용
            - 샵(#) 사용
### URN
- URL의 단점
    - 위치를 기반으로 식별하는데 자원의 위치는 언제든 변할 수 있음
- URN의 장점
    - 자원에 고유한 이름을 붙이는 이름 기반 식별자라 자원의 위치와 무관하게 자원을 식별
- URN은 아직 URL만큼 널리 채택된 방식은 아님
